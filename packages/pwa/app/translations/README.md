# Localization

Most of the files in this folder are generated by `react-intl` **CLI tool**:
- `pwa/app/translations/en.json` <- output of _extracting_ the default messages, which you can send to your translators
- `pwa/app/translations/[locale].json` <- these are the files that your translators made for the other locales
- `pwa/app/translations/compiled/[locale].json` <- output of _compiling_ the messages into AST format
  - Compiling helps improve the performance because it allows `react-intl` to skip the parsing step

Several **npm scripts** are available to you that make it easier to use this CLI tool. See `pwa/package.json` for more details.

- To **extract the default messages** in your app, run `npm run extract-messages` to have all of the default English messages extracted into their own json file.
- To **compile the messages** from all of the locales, run `npm run compile-messages`.

### Formatting messages

To support localization for multiple locales, you will be writing the messages:

-   _inline_ in the components, so it’s easier to see where in the page or component that they get used in
-   and in the **default locale** (for example, in English)

For example, in your React component, you can add formatted messages like `intl.formatMessage({defaultMessage: '...'})` or `<FormattedMessage defaultMessage="..." />`

At the minimum, only defaultMessage is the required parameter. The message id is optional. If you don’t specify it, the id will be auto-generated for you.

### Workflow between developers and translation team

During your development, you’ll extract and compile the messages and pass the generated json files to the translation team, as well as using the translated files in the app.

We’ve provided a few npm scripts to help you:

-   `npm run extract-messages` to extract the default messages
    -   so you don’t need to worry about handcrafting the json file yourself
-   `npm run compile-messages` to compile all locales into Abstract Syntax Tree (AST) format
    -   `react-intl` can use this AST format to bypass the parsing step and thus, save a bit of time.

Whenever you do a build, the above extract and compile scripts would automatically get run, in case you’ve forgotten to extract the latest messages.

### Testing with pseudo locale

To check whether you’ve wrapped all of the hardcoded strings with either `intl.formatMessage()` or `<FormattedMessage />` , there’s a quick way to test that by running `npm run start:pseudolocale`. It will run your local dev server with the locale forced to the pseudo locale.

Loading the site in your browser, you’ll quickly find that those messages that have been formatted would have long `SSS` appended to them.

### Tips

Here are a few useful things to know for developers.

#### User-preferred locales vs. app-supported locales

How a locale gets chosen depends on whether there’s a match found between 2 sets of locales. On a high level, it looks like this:

1. Get the app-supported locales, which are defined in package.json (under `l10n.supportedLocales`).
2. Get the user-preferred locales, which are what the visitors prefer to see. This is currently left for the developers to fully implement in their own projects within the special `_app` component.
3. If there’s a match between these 2 sets of locales, then the app would use it as the target locale.
4. Otherwise, the app would fall back to its default locale (which is also defined in package.json under `l10n.defaultLocale` ).

#### How to detect the active locale

-   Within component render, `useIntl` hook is available to you: `const {locale} = useIntl()`
-   Within a page’s `getProps` , there’s a `params` prop (specifically `params.locale`) coming from the routes that can tell you about which locale is being used in the current page URL.

#### Dynamic loading of the translation files

Using dynamic import, regardless of how many locales the app supports, it would load only one locale at a time.

Initially, on app load, the translated messages will be part of the server-rendered html. Afterwards on the client side, when dynamically changing the locale, the app would download the json file associated with that locale.

-   Each locale is a separate json file in the bundle. And it’s served with a 1-year cache header.
-   When a new bundle is deployed, you’ll need to download the json files again.

#### Link component

The generated project comes with its own `Link` component. It will automatically insert the locale in the URLs for you.
